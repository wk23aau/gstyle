# AI CV Maker Application
#Never ever change the gemini model gemini-1.5-flash-latest anywhere, it should always be gemini-1.5-flash-latest.

This project is a modern landing page for an AI-powered CV Maker. Users can input a job title or description to get a tailored CV outline generated by AI. It features distinct dashboards for regular users and administrators, with real-time analytics insights for admins, comprehensive informational pages, email verification for user signups, and a secure password reset flow.

## Key Features

*   AI-powered CV outline generation via a backend service.
*   Responsive design with Tailwind CSS.
*   Interactive UI built with React.
*   **User Authentication with Roles, Email Verification & Password Reset**:
    *   Login/Sign Up with Email/Password.
        *   **Email Verification**: New users signing up with email/password receive a verification email. They must click the link in the email to verify their account before they can log in.
        *   Option to resend verification email.
        *   **Forgot Password**: Users can request a password reset link to their verified email address.
    *   **Sign in with Google (OAuth 2.0)**.
    *   Authentication requests are handled by the backend.
    *   Users can have 'user' or 'admin' roles, providing access to different dashboards.
    *   Login state persists across page refreshes using \`localStorage\`.
*   **Comprehensive User Profile**: Users can input detailed information including personal details, address, work experience, education, skills summary, languages, awards, publications, seminars/conferences, and hobbies.
*   Modular Node.js/Express backend to handle API calls securely.
*   Separate **User Dashboard** and **Admin Dashboard**.
*   **Google Analytics Integration**: 
    *   Tracks page views using \`gtag.js\`.
    *   Admin dashboard displays live "Current Active Users" and "Top Active Pages" fetched via Google Analytics Data API.
    *   Provides a direct link to the full Google Analytics dashboard.
*   **Static Informational Pages**: Includes About Us, Contact Us, Privacy Policy, Terms of Service, and Data Sharing & GDPR Consent pages, with policies updated for ad network compliance readiness.

## Project Structure

The application follows a modular structure for better organization and maintainability.

### Frontend (`src/`, `components/`, `pages/`, `services/`)

*   **`src/index.tsx`**: Main entry point for the React application.
*   **`src/App.tsx`**: Root application component, handles routing and global state (like authentication).
*   **`src/types/index.ts`**: Centralized TypeScript type definitions for the frontend.
*   **`components/`**: Contains reusable UI components.
    *   `AuthModal.tsx`: Login/Signup modal.
    *   `Footer.tsx`: Application footer.
    *   `HeroSection.tsx`: Main landing page content.
    *   `Navbar.tsx`: Navigation bar.
    *   `ProtectedRoute.tsx`: Route guard for authenticated users.
    *   `dashboard/sections/`: Modular components for each section of the `UserDashboardPage`.
*   **`pages/`**: Contains top-level components for each page/route.
    *   `AdminDashboardPage.tsx`: Dashboard for admin users.
    *   `UserDashboardPage.tsx`: Dashboard for regular users.
    *   Static informational pages (e.g., `AboutUsPage.tsx`, `PrivacyPolicyPage.tsx`).
    *   Authentication flow pages (e.g., `VerifyEmailPage.tsx`, `ResetPasswordPage.tsx`).
*   **`services/`**: Frontend services for making API calls to the backend.
    *   `authService.ts`: Handles authentication-related API calls.
    *   `geminiService.ts`: Handles API calls for CV generation.
*   **`constants.tsx`**: Shared constants, like SVG icons.
*   **`public/`**: Static assets.
*   **`index.html`**: Main HTML file.

### Backend (`server/`)

The backend is built with Node.js and Express, structured modularly:

*   **`server/main.js`**: The main entry point for the backend server. Initializes Express, sets up middleware, loads configurations, mounts routes, and starts the server.
*   **`server/config/`**: Configuration files.
    *   `appConfig.js`: General application constants for the backend (e.g., `ADMIN_EMAIL`).
    *   `database.js`: Database (MySQL) connection setup and initialization. Exports the `dbPool`.
    *   `mailer.js`: Nodemailer transporter setup for sending emails. Exports the `mailTransporter`.
    *   `analytics.js`: Google Analytics Data API client setup. Exports the `analyticsDataClient`.
*   **`server/routes/`**: API route definitions. Each file typically defines routes for a specific resource or feature.
    *   `authRoutes.js`: Handles all authentication-related API endpoints (e.g., `/api/auth/login`, `/api/auth/signup`).
    *   `cvRoutes.js`: Handles API endpoints for CV generation.
    *   `analyticsRoutes.js`: Handles API endpoints for fetching analytics data.
*   **`server/services/`**: Contains the business logic for the application. Services are used by routes to perform actions.
    *   `authServiceInternal.js`: Orchestrates authentication logic (signup, login, token verification, etc.), interacting with `userService` and `emailService`.
    *   `userService.js`: Manages user data interactions with the database (creating users, finding users, updating passwords, etc.).
    *   `emailService.js`: Handles the sending of emails (verification, password reset).
    *   `aiService.js`: Logic for interacting with the AI (Gemini) API for CV generation.
    *   `analyticsService.js`: Logic for fetching and processing Google Analytics data.
*   **`server/utils/`**: Utility/helper functions.
    *   `sanitizeUser.js`: Function to remove sensitive information from user objects before sending them in API responses.
    *   `tokenUtils.js`: Functions for generating and hashing cryptographic tokens.

## Architecture Overview

The application exclusively uses a **frontend-backend architecture**:

1.  **Frontend (React + Vite)**: The user interface built with React and served by Vite. It captures user input for CV generation and detailed user profile information. For Google Sign-In, it uses Google Identity Services (GIS) to obtain an ID token, which is then sent to the backend. Based on the user's role (received after login), it directs them to the appropriate dashboard. Includes Google Analytics (gtag.js) for basic site tracking. The admin dashboard fetches and displays real-time analytics data from the backend. User login state is persisted in \`localStorage\`. Provides several static informational pages for users and handles the email verification and password reset flows.
2.  **Backend (Node.js/Express)**: A modular Node.js server that:
    *   Receives CV generation requests, calls a third-party AI API (using the \`@google/genai\` SDK with the \`gemini-1.5-flash-latest\` model) with the necessary API key, and returns the result (handled by `server/services/aiService.js` and `server/routes/cvRoutes.js`).
    *   Receives authentication requests (email/password and Google ID tokens), processes them against a MySQL database (which includes user roles, email verification status, and password reset tokens), and returns user data/mock tokens. Sensitive information is stripped from user objects (handled by `server/services/authServiceInternal.js`, `server/services/userService.js`, and `server/routes/authRoutes.js`).
    *   Handles email verification and password reset: generates tokens, sends emails using \`nodemailer\`, verifies tokens, and updates user status/passwords (handled by `server/services/emailService.js` and `server/services/authServiceInternal.js`).
    *   Assigns an 'admin' role to users logging in/signing up with a predefined \`ADMIN_EMAIL\`.
    *   Fetches real-time Google Analytics data using the \`@google-analytics/data\` library and a service account, providing this data to the admin dashboard (handled by `server/services/analyticsService.js` and `server/routes/analyticsRoutes.js`).

This approach ensures API keys, sensitive authentication logic, Google Cloud service account credentials, and SMTP credentials are managed securely on the server-side.

## Running the Application

### 1. Backend Server Setup & Run
(Refer to \`GAsetup.md\`, `smtp.md`, and the \`.env\` example below for environment variable details regarding service accounts, API keys, DB, and SMTP configuration.)

1.  **Navigate to the project root directory.**
2.  **Install backend dependencies:**
    \`\`\`bash
    npm install
    \`\`\`
3.  **Set up MySQL Database:** (As per previous instructions and schema below).
 \`\`\`bash
 docker run --name mysql-aicv -e MYSQL_ROOT_PASSWORD=password -e MYSQL_DATABASE=aicvmakeroauth -p 3306:3306 -d mysql:8
 \`\`\`
4.  **Google Cloud Console Setup for OAuth 2.0 & Analytics Data API:** (As per \`GAsetup.md\` and notes in "Development Environment Considerations" below).
5.  **Configure \`.env\` file:** See the "Final \`.env\` Example Snapshot" section below. Ensure all credentials are correct, especially `SMTP_PASS`.
6.  **Start the backend server:**
    The backend server listens on the port defined by the \`PORT\` environment variable (e.g., in your `.env` file), or defaults to \`3001\` if not set. If your frontend Vite proxy targets a specific port, ensure the backend runs on that port.
    \`\`\`bash
    # Example: If PORT=3001 in your .env or if not set, it runs on 3001
    node server/main.js 
    # Or, if you want to override .env or no .env PORT is set:
    # PORT=3001 node server/main.js 
    \`\`\`
    (The server log will confirm: `Backend server listening at http://localhost:YOUR_BACKEND_PORT`)

### 2. Frontend Setup & Run
1.  **Navigate to the project root directory** (if not already there).
2.  **(If first time or dependencies changed):**
    \`\`\`bash
    npm install 
    \`\`\`
3.  **Configure Vite (vite.config.ts):**
    The frontend uses Vite. If you are running the frontend on a different port than the backend (e.g., frontend on `5173`, backend on `3001`), you'll need to configure Vite to proxy API requests and set appropriate headers. This is done in `vite.config.ts`.
4.  **Start the frontend development server:**
    \`\`\`bash
    npm run dev
    \`\`\`
    This usually starts the frontend on a port like \`5173\` (check your Vite config or terminal output: `➜  Local:   http://localhost:YOUR_VITE_PORT/`).

## Port Configuration Summary for Development

*   **Backend Server Port:** Defined by `PORT` in your `.env` file (or defaults to `3001`). Example: `3001`.
*   **Frontend Vite Dev Server Port:** Defined in `vite.config.ts` via `server.port`. Example: `5173`.
*   **Vite Proxy Target:** In `vite.config.ts`, `proxy['/api'].target` MUST be your **Backend Server URL** (e.g., `http://localhost:3001`).
*   **`FRONTEND_BASE_URL` (in `.env` for backend):** MUST be your **Frontend Vite Dev Server URL** (e.g., `http://localhost:5173`) for correct email links.
*   **Google OAuth Authorized JavaScript Origins:** Must include your **Frontend Vite Dev Server URL** (e.g., `http://localhost:5173`).

## Development Environment Considerations (Frontend/Backend on Different Ports)

If you run your frontend Vite dev server on a different port than your backend:

*   **Vite Proxy (`vite.config.ts`):** Configure Vite to proxy API calls (e.g., requests to `/api/*`) to your backend server.
*   **Backend Port:** Ensure your backend server (`server/main.js`) is running on the port specified in the `target` of your Vite proxy configuration (e.g., `PORT=3001` in `.env`).
*   **`FRONTEND_BASE_URL` in `.env` (for backend use):** This environment variable is crucial. It must match the exact URL (including port) your frontend is accessible at during development.
*   **Google OAuth Authorized JavaScript Origins:** In your Google Cloud Console, for your OAuth 2.0 Client ID, you **must** add your frontend development URL to the "Authorized JavaScript origins".

## API Key & Credentials Management
(Refer to \`.env\` example and `GAsetup.md`, `smtp.md`)
*   **SMTP Error "535 Incorrect authentication data":** This means `SMTP_USER` and/or `SMTP_PASS` in your `.env` file are incorrect.

## Authentication & User Roles
*   Email/Password & Sign in with Google.
*   Email Verification and Password Reset flows are implemented.
*   User Roles: Admin role assigned based on \`ADMIN_EMAIL\`.
*   Session Persistence via \`localStorage\`.
*   Security: Sensitive data (hashed passwords, tokens) are not exposed in API responses. User objects include a `hasLocalPassword` flag.

## Google Analytics
(Refer to `GAsetup.md`)

## Database Schema (MySQL)
⚠️ **Caution:** Escape identifiers in SQL queries, e.g., `` `CREATE DATABASE IF NOT EXISTS \`${dbName}\`;` `` or use parameterized identifiers.

The \`users\` table includes fields for email verification and password reset:

\`\`\`sql
CREATE TABLE IF NOT EXISTS users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  email VARCHAR(255) NOT NULL UNIQUE,
  password VARCHAR(255), 
  name VARCHAR(255),
  google_id VARCHAR(255) UNIQUE, 
  role VARCHAR(50) DEFAULT 'user',
  is_email_verified BOOLEAN DEFAULT FALSE,
  email_verification_token VARCHAR(255) NULLABLE, -- Stores a HASH of the token
  email_verification_token_expires_at TIMESTAMP NULLABLE,
  password_reset_token VARCHAR(255) NULLABLE, -- Stores a HASH of the token
  password_reset_token_expires_at TIMESTAMP NULLABLE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
\`\`\`
*Note: Token columns store hashed versions of the tokens.*

## Final \`.env\` Example Snapshot

Create a \`.env\` file in the project root. **This file is read by your backend (`server/main.js`).**

\`\`\`dotenv
# AI Service API Key (e.g., for Google Gemini)
API_KEY=YOUR_ACTUAL_AI_SERVICE_API_KEY

# Google OAuth Client ID (for user Google Sign-In on frontend & backend verification)
GOOGLE_CLIENT_ID=YOUR_GOOGLE_WEB_CLIENT_ID.apps.googleusercontent.com

# Admin Email (for assigning admin role on login/signup)
ADMIN_EMAIL=admin@example.com 

# MySQL Database Configuration
DB_HOST=localhost
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_NAME=aicvmakeroauth
DB_PORT=3306

# Backend Server Port (Optional, defaults to 3001 if not set)
PORT=3001 

# Google Analytics Data API Configuration
GOOGLE_APPLICATION_CREDENTIALS=./service-account-key.json 
GA_PROPERTY_ID=YOUR_GA4_PROPERTY_ID 

# Email (Nodemailer SMTP) Configuration - SEE smtp.md FOR DETAILS
SMTP_HOST=mail.onlinecvgenius.com
SMTP_PORT=465 
SMTP_SECURE=true 
SMTP_USER=admin@onlinecvgenius.com 
SMTP_PASS=YOUR_ACTUAL_SMTP_PASSWORD 
SMTP_FROM_EMAIL=admin@onlinecvgenius.com
SMTP_FROM_NAME="AI CV Maker"

# Frontend Base URL (for generating links in emails by the backend)
# IMPORTANT: This MUST match the URL your frontend Vite dev server is accessible at.
FRONTEND_BASE_URL=http://localhost:5173 

# --- Vite Environment Variables (Prefix with VITE_) ---
# These are loaded by Vite for frontend use. Place them in this .env file.
# Vite's .env handling: https://vitejs.dev/guide/env-and-mode.html

# Google OAuth Client ID (for frontend Google Sign-In button)
VITE_GOOGLE_CLIENT_ID=YOUR_GOOGLE_WEB_CLIENT_ID.apps.googleusercontent.com

# Google Analytics Measurement ID (for gtag.js in index.html)
VITE_GA_MEASUREMENT_ID=G-YOUR_GA_MEASUREMENT_ID
\`\`\`

## Development Process & Changelog

**IMPORTANT**:
*   **Changelog**: After every successful update or change to the codebase, please update the `changelog.md` file in the project root. This helps maintain a clear history of modifications.
*   **README Maintenance**: Similarly, ensure `README.md` is kept current with any changes to setup procedures, project structure, environment variable usage, or core application functionality. Accurate documentation is crucial for project understanding and collaboration.

## Codebase Management and Professional Structure Guidelines

To maintain a clean, manageable, and professional codebase:

1.  **Follow the Established Modular Structure:**
    *   **Frontend:** Keep components in `components/`, pages in `pages/`, services in `services/`, and types in `src/types/`. Break down large components or pages into smaller, focused sub-components (e.g., `components/dashboard/sections/`).
    *   **Backend:** Adhere to the `config/`, `routes/`, `services/`, and `utils/` separation. Business logic should reside in services, route definitions in routes, configuration in config, and reusable helpers in utils. `server/main.js` should remain lean, primarily for setup and orchestration.
2.  **Single Responsibility Principle:** Each module, class, or function should ideally have one primary responsibility.
3.  **Clear Naming Conventions:** Use descriptive and consistent names for files, variables, functions, and components.
4.  **Type Safety (TypeScript):** Leverage TypeScript for both frontend and backend (where applicable, e.g., using JSDoc for backend JS if not migrating fully to TS). Define clear interfaces and types, especially for API request/response payloads and shared data structures (`src/types/index.ts`).
5.  **Code Comments:** Add comments to explain complex logic, non-obvious decisions, or to document public APIs of modules/functions.
6.  **Error Handling:** Implement robust error handling in both frontend services (catching API errors, displaying user-friendly messages) and backend services (logging errors, sending appropriate HTTP status codes and error responses).
7.  **Environment Variables:** Store all sensitive information (API keys, database credentials, secret keys) and environment-specific configurations in `.env` files. Never hardcode these values.
8.  **Dependencies:** Keep dependencies updated and remove unused ones.
9.  **Linting and Formatting:** Use a linter (like ESLint) and a code formatter (like Prettier) to maintain consistent code style and catch potential issues early. Configure these tools and adhere to their rules.
10. **Testing:** (Future Goal) Implement unit and integration tests for critical parts of the application, especially services and complex components.
11. **Changelog:** As stated, update `changelog.md` for every significant change.
12. **README Updates:** Keep `README.md` (especially sections like Project Structure, Setup, and API documentation if added) current with any major architectural or operational changes.

By adhering to these guidelines, the project will be easier to understand, debug, scale, and collaborate on.

## Recent Updates (from Changelog via README)
Refer to `changelog.md` for the most up-to-date list of changes.
Previous entries regarding User Dashboard Password Guidance, Login & Password Management Enhancement, Security Enhancement, SMTP Configuration, etc., can be found by reviewing the history of `changelog.md`.
