
# AI CV Maker Application
#Never ever change the gemini model gemini-1.5-flash-latest anywhere, it should always be gemini-1.5-flash-latest.

after every update/change add changelog to the readme.md

while copying project skip enclose.py and package-lock.json and other similar unnecessary files.

This project is a modern landing page for an AI-powered CV Maker. Users can input a job title or description to get a tailored CV outline generated by AI. It features distinct dashboards for regular users and administrators, with real-time analytics insights for admins, comprehensive informational pages, email verification for user signups, and a secure password reset flow.

## Key Features

*   AI-powered CV outline generation via a backend service.
*   Responsive design with Tailwind CSS.
*   Interactive UI built with React.
*   **User Authentication with Roles, Email Verification & Password Reset**:
    *   Login/Sign Up with Email/Password.
        *   **Email Verification**: New users signing up with email/password receive a verification email. They must click the link in the email to verify their account before they can log in.
        *   Option to resend verification email.
        *   **Forgot Password**: Users can request a password reset link to their verified email address.
    *   **Sign in with Google (OAuth 2.0)**.
    *   Authentication requests are handled by the backend.
    *   Users can have 'user' or 'admin' roles, providing access to different dashboards.
    *   Login state persists across page refreshes using `localStorage`.
*   **Comprehensive User Profile**: Users can input detailed information including personal details, address, work experience, education, skills summary, languages, awards, publications, seminars/conferences, and hobbies.
*   Node.js/Express backend (`server/main.js`) to handle API calls securely.
*   Separate **User Dashboard** and **Admin Dashboard**.
*   **Google Analytics Integration**: 
    *   Tracks page views using `gtag.js`.
    *   Admin dashboard displays live "Current Active Users" and "Top Active Pages" fetched via Google Analytics Data API.
    *   Provides a direct link to the full Google Analytics dashboard.
*   **Static Informational Pages**: Includes About Us, Contact Us, Privacy Policy, Terms of Service, and Data Sharing & GDPR Consent pages, with policies updated for ad network compliance readiness.

## Architecture Overview
(The architecture overview remains largely the same but now implicitly includes password reset logic in the backend auth handling)
The application exclusively uses a **frontend-backend architecture**:

1.  **Frontend (React + Vite)**: The user interface built with React and served by Vite. It captures user input for CV generation and detailed user profile information. For Google Sign-In, it uses Google Identity Services (GIS) to obtain an ID token, which is then sent to the backend. Based on the user's role (received after login), it directs them to the appropriate dashboard. Includes Google Analytics (gtag.js) for basic site tracking. The admin dashboard fetches and displays real-time analytics data from the backend. User login state is persisted in `localStorage`. Provides several static informational pages for users and handles the email verification and password reset flows (receiving tokens, showing messages).
2.  **Backend (Node.js/Express)**: A Node.js server (`server/main.js`) that:
    *   Receives CV generation requests, calls a third-party AI API (using the `@google/genai` SDK with the `gemini-1.5-flash-latest` model) with the necessary API key, and returns the result.
    *   Receives authentication requests (email/password and Google ID tokens), processes them against a MySQL database (which includes user roles, email verification status, and password reset tokens), and returns user data (including role)/mock tokens.
    *   Handles email verification: generates tokens, sends verification emails using `nodemailer` via SMTP, and verifies tokens.
    *   Handles password reset: generates tokens, sends password reset emails, verifies reset tokens, and updates passwords.
    *   Assigns an 'admin' role to users logging in/signing up with a predefined `ADMIN_EMAIL`.
    *   **Fetches real-time Google Analytics data** using the `@google-analytics/data` library and a service account, providing this data to the admin dashboard.

This approach ensures API keys, sensitive authentication logic, Google Cloud service account credentials, and SMTP credentials are managed securely on the server-side.

## Running the Application
(Instructions remain the same, ensure environment variables are set as per the example)

### 1. Backend Server Setup & Run
(Refer to `GAsetup.md` and the `.env` example below for environment variable details regarding service accounts, API keys, DB, and SMTP configuration.)

1.  **Navigate to the project root directory.**
2.  **Install backend dependencies:**
    ```bash
    npm install
    ```
3.  **Set up MySQL Database:** (As per previous instructions and schema below).
4.  **Google Cloud Console Setup for OAuth 2.0 & Analytics Data API:** (As per `GAsetup.md`).
5.  **Configure `.env` file:** See the "Final `.env` Example Snapshot" section below.
6.  **Start the backend server:**
    ```bash
    node server/main.js
    ```

### 2. Frontend Setup & Run
(Instructions remain the same)

## API Key & Credentials Management
(Instructions remain the same, refer to `.env` example)

## Authentication & User Roles
*   **Email/Password & Sign in with Google** as described.
*   **Email Verification**: Users signing up with email/password must verify their email address via a link sent to them before they can log in.
*   **Password Reset**: Users can request a password reset link to their verified email.
*   **User Roles**: Admin role assigned based on `ADMIN_EMAIL`.
*   **Session Persistence**: User login state is persisted in `localStorage`.

## Google Analytics
(Description remains the same)

## Database Schema (MySQL)

The `users` table needs to be updated for email verification and password reset:

```sql
CREATE TABLE IF NOT EXISTS users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  email VARCHAR(255) NOT NULL UNIQUE,
  password VARCHAR(255), 
  name VARCHAR(255),
  google_id VARCHAR(255) UNIQUE, 
  role VARCHAR(50) DEFAULT 'user',
  is_email_verified BOOLEAN DEFAULT FALSE,
  email_verification_token VARCHAR(255) NULLABLE, -- Stores a HASH of the token
  email_verification_token_expires_at TIMESTAMP NULLABLE,
  password_reset_token VARCHAR(255) NULLABLE, -- Stores a HASH of the token
  password_reset_token_expires_at TIMESTAMP NULLABLE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
*Note: `email_verification_token` and `password_reset_token` should store a hashed version of the token sent to the user for security.*

## Final `.env` Example Snapshot

Create a `.env` file in the project root with the following content, replacing placeholder values with your actual credentials and settings:

```dotenv
# AI Service API Key (e.g., for Google Gemini or other AI provider)
API_KEY=YOUR_ACTUAL_AI_SERVICE_API_KEY

# Google OAuth Client ID (for user Google Sign-In for web)
VITE_GOOGLE_CLIENT_ID=YOUR_GOOGLE_WEB_CLIENT_ID.apps.googleusercontent.com
GOOGLE_CLIENT_ID=YOUR_GOOGLE_WEB_CLIENT_ID.apps.googleusercontent.com

# Admin Email (for assigning admin role on login/signup)
ADMIN_EMAIL=admin@example.com 

# MySQL Database Configuration
DB_HOST=localhost
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_NAME=aicvmakeroauth
DB_PORT=3306

# Google Analytics Data API Configuration
# Path to your downloaded service account JSON key file (relative to project root)
GOOGLE_APPLICATION_CREDENTIALS=./service-account-key.json 
# Your Google Analytics 4 Property ID (the numeric ID)
GA_PROPERTY_ID=YOUR_GA4_PROPERTY_ID 

# Email (Nodemailer SMTP) Configuration
SMTP_HOST=smtp.example.com
SMTP_PORT=587 # Or 465 for SSL
SMTP_SECURE=false # true for port 465, false for 587 (STARTTLS)
SMTP_USER=your_smtp_username_or_email
SMTP_PASS=your_smtp_password_or_app_password
SMTP_FROM_EMAIL=noreply@example.com
SMTP_FROM_NAME=AI CV Maker

# Frontend Base URL (for generating links in emails)
FRONTEND_BASE_URL=http://localhost:5173 # Or your production frontend URL
```

## Update Instructions & Changelog

### Forgot Password / Password Reset Flow
*   **`server/main.js` (Updated):**
    *   Updated `users` table schema initialization to include `password_reset_token` and `password_reset_token_expires_at`.
    *   Added `/api/auth/request-password-reset` endpoint: if user exists and email is verified, generates a token, stores its hash, and sends a password reset email.
    *   Added `/api/auth/reset-password` endpoint: validates the provided token (by hashing it and comparing to DB), checks expiry, and if valid, updates the user's password and clears the token.
*   **`App.tsx` (Updated):** Added routes for `/request-password-reset` and `/reset-password`.
*   **`components/AuthModal.tsx` (Updated):** Added a "Forgot Password?" link to the login form.
*   **`services/authService.ts` (Updated):** Added `requestPasswordReset` and `resetPassword` functions.
*   **`pages/RequestPasswordResetPage.tsx` (New):** Page for users to request a password reset link via email.
*   **`pages/ResetPasswordPage.tsx` (New):** Page for users to enter a new password using the token received in the email.
*   **`README.md` (Updated):** Documented the password reset feature and updated the database schema.

### Email Verification for Email/Password Signup
(Previous changelog entries remain)

(Previous changelog entries remain)
